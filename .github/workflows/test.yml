name: Publish Docker image

on:
  push:
    branches: [ "main" ]
  workflow_dispatch:

env:
  TEST_GITHUB_TOKEN: ${{ secrets.DOCKERHUB_USERNAME }}
  TEST_SECRET: aonna
  IMAGE_NAME: alpine-test
  VERSION: 1.0.0

jobs:
  push_to_registry:
    name: Push Docker image to Docker Hub
    runs-on: ubuntu-latest
    environment: test   
    steps:
      - name: Check out the repo
        uses: actions/checkout@v2

      - run: echo "Hello World" > file.txt
      - uses: actions/upload-artifact@v1
        with:
          name: file
          path: file.txt
          
      - name: Get Private Key  
        run: |
              echo "${{ secrets.SSH_KEY }}" > ssh_dev_private_key
              chmod 600 ssh_dev_private_key
        
      - name: Do something on server
        run: ssh -i ssh_dev_private_key -o StrictHostKeyChecking=no ${{ secrets.USER }}@${{ secrets.HOSTNAME }} pwd
