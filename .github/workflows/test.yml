name: Docker Publish


on:
  push:
    branches: [ "main" ]
  workflow_dispatch:

  # env:
  name: GitHub Actions Demo
    # on: [push]
    jobs:
      Explore-GitHub-Actions:
        runs-on: ubuntu-latest
        steps:
          - run: echo "ğŸ‰ The job was automatically triggered by a ${{ github.event_name }} event."
          - run: echo "ğŸ§ This job is now running on a ${{ runner.os }} server hosted by GitHub!"
          - run: echo "ğŸ” The name of your branch is ${{ github.ref }} and your repository is ${{ github.repository }}."
          - name: Check out repository code
            uses: actions/checkout@v3
          - run: echo "ğŸ’¡ The ${{ github.repository }} repository has been cloned to the runner."
          - run: echo "ğŸ–¥ï¸ The workflow is now ready to test your code on the runner."
          - name: List files in the repository
            run: |
              ls ${{ github.workspace }}
          - run: echo "ğŸ This job's status is ${{ job.status }}."
          - run: bash test.sh

  jobs:
    package:
      runs-on: ubuntu-latest

      steps:
      - uses: actions/checkout@v3
      - name: Checkout git 
    
      - name: Log into Docker Hub registry
        uses: docker/login-action@v2
        with:
          username: ${{ secrets.DOCKERHUB_USERNAME }}
          password: ${{ secrets.DOCKERHUB_PASSWORD }}
      
      - name: Build the Docker image
        run: docker build --tag ${IMAGE_NAME}:${VERSION} .
        
      - name: Push the Docker image
        run: docker push ${IMAGE_NAME}:${VERSION}